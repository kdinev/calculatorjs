/*! CalculatorJS 2015-02-25 */
!function(a){a.widget("ui.calculator",{_css:{calculator:"ui-widget ui-calculator",displayValue:"calc-display-value"},options:{documentKeyboard:!0},_parser:null,_create:function(){this._parser=new Epsilon.ExpressionParser,this._render(),this._options={},this._options.display=this.element.find("."+this._css.displayValue),this._attachEvents(),this.element.addClass(this._css.calculator),this.options.focused&&this._options.display.focus()},_render:function(){var a="<table><thead><tr><td colspan='4' class='"+this._css.displayValue+"'>0</td></tr></thead><tbody><tr><td>Del</td><td>C</td><td></td><td>/</td></tr><tr><td>7</td><td>8</td><td>9</td><td>*</td></tr><tr><td>4</td><td>5</td><td>6</td><td>-</td></tr><tr><td>1</td><td>2</td><td>3</td><td>+</td></tr><tr><td colspan='2'>0</td><td>.</td><td>=</td></tr></tbody></table>";this.element.html(a)},_attachEvents:function(){var b=this._options.display,c=this;this.element.on("click","tbody td",function(){var d=a(this),e=d.text();switch(e){case"=":c._evaluate();break;case"C":b.text(0);break;case"Del":c._delete();break;default:c._input(e)}c._animateButton(d)}),this.options.documentKeyboard&&a(document).on("keydown",function(a){c._handleKeydown(a)})},_allowedKeys:{8:"Del",13:"=",46:"C",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",190:"."},_handleKeydown:function(a){if(!(a.keyCode in this._allowedKeys))return!1;var b=this._allowedKeys[a.keyCode];switch(this._animateButton(this.element.find("tbody td:contains("+b+")")),a.keyCode){case 8:this._delete();break;case 13:this._evaluate();break;case 46:this._options.display.text(0);break;default:this._input(b)}},_evaluate:function(){var a,b=this._options.display,c=b.text();this._clear=!0,this._parser.setExpression(c);try{a=this._parser.evaluate()}catch(d){a="ERROR!"}isNaN(a)&&(a="ERROR!"),b.text(a)},_delete:function(){var a=this._options.display,b=a.text();1===b.length&&(b="0",a.text(0)),"0"!==b&&a.text(b.substring(0,b.length-1))},_input:function(a){var b=this._options.display,c=b.text();switch(a){case"+":case"-":case"*":case"/":this._clear=!1}"."!==c&&"0"===c||this._clear?(this._clear=!1,b.text(a)):b.text(c+a)},_animateButton:function(a){a.stop(!0,!0).animate({"background-color":"#FFC500"},150,function(){a.animate({"background-color":"#FFF"},150)})},_destroy:function(){this.element.off(),this.element.empty()}})}(jQuery);